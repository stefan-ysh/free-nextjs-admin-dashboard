# 采购审批系统目标与进度清单

更新时间：2026-02-07

## 1. 已确认的业务规则

- 提交流程：`提交 -> 待审批`（不再自动批准）。
- 预算口径：按`部门预算`实时校验。
- 入库确认：支持`申请人`和`仓管`两类角色执行确认。
- 付款任务：独立页面管理，不混在审批页。
- 流程监控：独立页面展示流程节点与停留时长。
- 审批操作：审批意见必填，支持转审。
- 采购组织：支持`学校`、`单位`。
- 人员体系：员工即用户，通过 `roles + primary_role` 控制权限。

## 2. 角色功能目标清单

### 普通员工

- [x] 新建采购申请（核心字段、附件上传、日期、金额、用途）。
- [x] 我的申请列表（状态查看、筛选）。
- [x] 撤销申请（需填写撤销原因）。
- [x] 复制申请（从历史单快速生成）。
- [x] 申请提交后进入待审批状态。
- [x] 预算实时展示与超额提示（部门预算）。
- [ ] 工作台首页（待办卡片、流程时间轴、快捷入口）进一步完善。
- [ ] 入库确认入口体验优化（移动端与桌面端一致性）。

### 管理员

- [x] 审批任务中心（通过/驳回/打款）。
- [x] 审批意见必填与转审能力。
- [x] 审批流程配置页面（可视化拖拽基础版）。
- [x] 供应商管理（主数据维护）。
- [x] 操作日志记录（提交/审批/打款等）。
- [ ] 审批规则引擎增强（条件分支、串签/或签深度规则）。
- [ ] 催办与超时提醒机制（自动化规则与通知配置）。

### 财务

- [x] 付款任务队列独立页面（待付款/进行中/已付款）。
- [x] 打款登记（金额、日期、流水、凭证）。
- [x] 可标记异常并回写流程状态。
- [ ] 对账视图（采购、付款、入库三方核对）增强。
- [ ] 归档打包（申请、审批、收货、打款凭证）导出能力。

## 3. UI / 交互规范进度

- [x] Drawer/Dialog 头尾固定、内容区滚动的统一模式。
- [x] 表格分页、空态、操作按钮风格统一（阶段性完成）。
- [x] 采购主表单采用统一栅格，短字段收敛宽度。
- [x] 采购申请人固定为当前登录人且不可修改。
- [x] 代付人改为人员选择器，不再手填自由文本。
- [x] “已打款后自动通知并完成流程”改为 tooltip 提示。
- [x] 发票“可跳过”提示并入标题，不再分离说明块。
- [x] 保存区固定底部，中间内容滚动。
- [ ] 全项目表单抽屉宽度与栅格规则继续统一（财务/供应商/库存余项）。
- [ ] 移动端表单密度和触控命中区域继续优化。

## 4. 数据与审计

- [x] 审批、驳回、打款、撤销等关键行为写入审计日志。
- [x] 部门预算数据结构已接入并可查询。
- [ ] 审计中心页（统一查询、筛选、导出）增强。
- [ ] 异常采购预警（短期重复采购、价格偏离）规则化。

## 5. 下一阶段开发顺序（执行中）

1. 完成剩余表单抽屉宽度与布局统一（重点财务、供应商、库存）。
2. 审批规则引擎增强（分支条件、签核策略）。
3. 流程监控页增强（节点超时、处理人负载、趋势）。
4. 审计中心与导出能力增强。
5. 移动端专项适配与企业微信接入准备。

## 6. 测试清单（每次迭代回归）

1. 新建采购：提交后状态必须为`待审批`。
2. 申请人字段：默认当前用户，前后端均不可篡改。
3. 预算校验：总额大于部门余额时出现明显提示。
4. 审批：通过/驳回均要求审批意见；驳回原因可追溯。
5. 转审：转审后当前处理人与待办正确变化。
6. 财务打款：标记已打款后，申请人收到通知，单据进入完成态。
7. 代付人：仅可从人员选择器选择，保存后展示名称正确。
8. 发票流程：选择“无需发票”时不强制开票字段。
9. 抽屉表单：Header/Footer 固定，内容超长可滚动。
10. 移动端：关键按钮可点击、表单不挤压、无横向溢出。
