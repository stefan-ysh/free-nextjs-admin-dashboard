# 采购审批系统总清单（主追踪文档）

> 目标：把你和我之前确认的需求、决策、现状差距、实施顺序统一沉淀，避免开发偏航或遗忘。  
> 最后更新时间：2026-02-07

## 1. 已确认的关键决策

- [x] 提交后状态改为 `待审批`（不再“提交即批准”）
- [x] 预算校验按“部门预算”
- [x] 入库确认支持两类角色（申请人、仓管）都可执行
- [x] 付款任务队列做“独立页面”
- [x] 流程监控做“独立页面”
- [x] 审批能力包含：审批意见必填 + 转审
- [x] 用户体系采用：`用户 = 员工`，权限通过 `roles + primary_role`
- [x] 登录标识支持：邮箱 / 手机号 / 员工编号

## 2. 角色功能需求清单（按你原始描述整理）

## 2.1 普通员工

- [ ] 工作台首页
- [ ] 待办提醒卡片（待我审批、我发起申请状态）
- [ ] 快捷入口（新建采购申请）
- [ ] 申请进度时间轴（审批中/待财务/已完成）
- [ ] 采购申请创建（标准化表单）
- [ ] 字段：物品、规格、数量、预估单价、总预算、事由、到货日期
- [ ] 预算实时校验（部门预算）
- [ ] 附件上传（说明书、报价单、纪要等）
- [ ] 多明细行（批量录入）
- [ ] 我的申请列表
- [ ] 状态跟踪（待审批/审批中/已批准/已驳回/待付款/已完成）
- [ ] 历史查询（时间、状态筛选）
- [ ] 查看详情
- [ ] 撤销申请（审批中且未终审）
- [ ] 复制申请
- [ ] 入库确认（到货数量、验收情况、收货凭证）

## 2.2 管理员

- [ ] 审批任务中心
- [ ] 待办列表（申请人、金额、紧急程度）
- [ ] 审批操作（通过/驳回）
- [ ] 审批意见必填（已实现基础版，继续完善配置化）
- [ ] 转审（已实现基础版，继续完善规则约束）
- [ ] 自动化审批流
- [ ] 规则路由（按金额/品类/部门）
- [ ] 串签与或签
- [x] 流程监控与督办（v1）
- [ ] 流程看板（节点、审批人、停留时长）
- [ ] 超时提醒/催办
- [ ] 系统管理
- [ ] 用户与权限管理（启停、重置密码、批量导入）
- [ ] 审批规则引擎（可视化拖拽）
- [ ] 供应商管理（已具备基础能力，继续增强评分与历史）
- [ ] 数据报表（部门支出、供应商绩效、采购周期）

## 2.3 财务

- [ ] 付款任务队列（独立页面）
- [ ] 状态筛选（待付款/付款中/已付款/异常）
- [ ] 办理付款（金额、日期、流水号、凭证）
- [ ] 标记异常并通知相关人
- [ ] 预算监控（部门维度）
- [ ] 财务归档（申请/审批/入库/付款凭证整单归档）

## 2.4 系统级能力

- [ ] 移动端适配（核心流程）
- [ ] 事后稽核机制
- [ ] 操作日志统一审计页（时间、操作人、类型、对象、IP、详情）
- [ ] 日志筛选与导出（Excel）
- [ ] 智能预警（异常采购、频繁同供应商、价格偏离）

## 3. 现阶段代码落实情况（截至当前）

## 3.1 已完成/已落地

- [x] 登录与员工账号体系重构（管理员创建员工、初始密码、重置密码）
- [x] 角色权限基础结构（`roles + primary_role`）
- [x] 采购基础表单重构（字段、附件、组织类型“学校/单位”）
- [x] 审批意见必填 + 转审（基础能力）
- [x] 付款记录与采购打款联动（基础能力）
- [x] 多处弹窗头尾结构统一（基于 Dialog/Drawer 组件）
- [x] 表单与页面移动端可用性修复（持续进行中）
- [x] 财务与采购抽屉拥挤问题首轮修复（抽屉布局与宽度）

## 3.2 进行中

- [ ] 抽屉表单视觉规范统一（间距、字段宽度、底部操作区）
- [ ] 项目/员工表单进一步统一到同一 UI 模板
- [ ] 流程与财务页的可视化与筛选体验精修

## 3.3 尚未落地（核心缺口）

- [ ] 部门预算表（数据库）与完整预算生命周期管理
- [ ] 审批流程引擎（可视化拖拽配置）
- [ ] 真正的流程看板与超时催办
- [ ] 付款任务独立页完善到完整闭环
- [ ] 稽核中心（统一日志、筛选、导出）

## 4. 开发实施计划（接下来）

## Phase A：流程主链先闭环（优先级 P0）

- [ ] A1. 提交 -> 待审批 主流程状态机全面核查（采购、审批、付款、入库）
- [ ] A2. 部门预算表设计与迁移
- [ ] A3. 采购表单接入实时预算校验（录入中 + 提交前双校验）
- [ ] A4. 付款任务独立页补齐（筛选、支付、异常、回写）
- [ ] A5. 入库确认流程与权限点（申请人/仓管）统一

## Phase B：管理员能力（优先级 P1）

- [ ] B1. 审批任务中心增强筛选（金额区间/紧急度/时间）
- [ ] B2. 转审规则增强（可转角色、操作审计）
- [x] B3. 流程监控看板（节点停留时长、超时高亮）`v1`
- [ ] B4. 审批规则引擎 v1（可视化拖拽 + 条件分支）
- [x] B4. 审批规则引擎 v1（可视化拖拽 + 条件分支）`基础配置页 + 保存/加载已上线`

## Phase C：审计与报表（优先级 P1）

- [ ] C1. 审计日志中心页面（采购/库存/财务统一）
- [ ] C2. 导出能力（Excel）
- [ ] C3. 报表页（部门、供应商、项目维度）

## Phase D：移动优化（优先级 P2）

- [ ] D1. 核心页面移动端交互优化（底部主操作固定）

## 5. 本周执行顺序（下一步）

- [ ] 1) 先完成 `部门预算表 + 预算 API + 采购表单实时校验`
- [ ] 2) 再完成 `付款任务独立页` 的闭环（打款/异常/筛选/回写）
- [x] 3) 最后推进 `流程监控看板 v1`
- [ ] 4) 推进 `审批规则引擎（可视化拖拽）v1`
- [x] 4) 推进 `审批规则引擎（可视化拖拽）v1`
- [ ] 5) 把流程配置接入“提交后自动路由审批人”
- [x] 5) 把流程配置接入“提交后自动路由审批人”

## 6. 变更原则

- [ ] 所有新增流程必须写审计日志
- [ ] 所有状态迁移都要有可追溯操作人和时间
- [ ] 抽屉内表单使用抽屉专用栅格（避免复用桌面 6 列导致拥挤）
- [ ] 桌面详情页可用高密度栅格，移动端降级为 1 列
