# Test Checklist (Current Baseline)

更新日期：2026-02-18

## 1. 采购流程
- [ ] 员工可创建采购草稿。
- [ ] 员工可提交采购申请进入待审批。
- [ ] 审批管理员可审批、驳回、转审。
- [ ] 审批通过后采购状态进入“待入库”。
- [ ] 申请人可执行入库；入库数量不可超过采购总量。
- [ ] 采购全部入库后状态进入完成态。

## 2. 报销流程
- [ ] 员工可创建报销草稿并保存。
- [ ] 提交报销时，至少有发票或收款凭证之一（按规则校验）。
- [ ] 报销来源为“关联采购”时：
  - [ ] 下拉仅显示可报销采购（非对公转账、满足关联条件）。
  - [ ] 已被关联的采购不可重复选择。
- [ ] 财务可在待办中看到待处理报销。
- [ ] 财务可执行“确认打款”与“驳回”。
- [ ] 驳回后申请人在待办中可继续处理并重提。

## 3. 财务流水与预算
- [ ] 预算调整可新增，并自动生成收支流水。
- [ ] 预算调整可编辑，并同步更新对应流水。
- [ ] 自动生成流水（如报销打款）不可手动编辑删除。
- [ ] 预算调整记录可删除（若业务允许）。

## 4. 角色与菜单
- [ ] 超级管理员：仅查看，不参与流程操作。
- [ ] 审批管理员：仅采购审批。
- [ ] 学校财务/单位财务：仅报销打款。
- [ ] 员工：采购申请、入库（受限）、报销申请。
- [ ] 菜单不存在多项同时高亮。

## 5. 待办/已办
- [ ] 待办：仅展示当前角色“需要处理”的事项。
- [ ] 已办：展示当前角色“已完成处理”的事项。
- [ ] 草稿不进入待办。
- [ ] 列表统一展示，不按模块分块。

## 6. 文件与预览
- [ ] COS 上传成功。
- [ ] 详情中展示原始文件名（非存储键）。
- [ ] 附件可在弹窗内预览，不强制新窗口。
- [ ] 权限不足时返回可理解错误信息。

## 7. 数据清理验证
- [ ] 下线表不存在：
  - `purchase_payments`
  - `purchase_workflow_configs`
  - `projects`
  - `project_payments`
  - `calendar_events`
  - `clients`
  - `client_contacts`
  - `client_logs`
- [ ] 主流程相关表数据完整可用。

## 8. 自动化体检命令
- [ ] 运行 `npm run check:purchases`，确认采购健康检查通过。
- [ ] 运行 `npm run check:workflow`，确认流程一致性检查通过。
- [ ] 运行 `npm run check:cleanup-removed`，确认下线模块清理状态为 PASS。
- [ ] 或直接运行 `npm run check:baseline` 一次性完成以上三项检查。
